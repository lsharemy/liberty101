title: 8051 双色点阵 c
tags:
  - '8051'
id: 893
categories:
  - wordpress
  - index.php
  - csit
date: 2011-12-25 18:46:55
---

双色点阵也就是双色LED组成的整列。在板子上，该阵列由74HC595芯片控制。关于双色LED，想想有些充电器上的灯，充电时显示红色，充满显示绿色，那就是双色LED。

双色点阵在很多显示屏上可以看到，如银行里的显示屏（一般是红色），还有一些户外的显示屏，一般大小和外形又些区别，原理其实都是一<!--more-->样的。

这里给出一个控制双色点阵显示心形的程序：

[c]
/*-----------------------------------------------
双色点阵
使用hc595驱动双色点阵
------------------------------------------------*/
#include&lt;reg52.h&gt;    //包含头文件，一般情况不需要改动，
#include &lt;intrins.h&gt;

//unsigned char  segout[8]={0,1,2,3,4,5,6,7}; //8列
unsigned char  segout[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80}; //8列
unsigned char code tab[]={0x00,0x6C,0x92,0x82,0x44,0x28,0x10,0x00};
/*------------------------------------------------
                硬件端口定义
------------------------------------------------*/

sbit LATCH = P1^0;
sbit SRCLK= P1^1;
sbit SER  = P1^2;

//公共端信号控制
sbit LATCH_B = P2^2;
sbit SRCLK_B= P2^1;
sbit SER_B= P2^0;

/*------------------------------------------------
 uS延时函数，含有输入参数 unsigned char t，无返回值
 unsigned char 是定义无符号字符变量，其值的范围是
 0~255 这里使用晶振12M，精确延时请使用汇编,大致延时
 长度如下 T=tx2+5 uS
------------------------------------------------*/
void DelayUs2x(unsigned char t)
{
    while(--t);
}
/*------------------------------------------------
 mS延时函数，含有输入参数 unsigned char t，无返回值
 unsigned char 是定义无符号字符变量，其值的范围是
 0~255 这里使用晶振12M，精确延时请使用汇编
------------------------------------------------*/
void DelayMs(unsigned char t)
{

    while(t--)
    {
        //大致延时1mS
        DelayUs2x(245);
	    DelayUs2x(245);
    }
}
/*------------------------------------------------
                发送字节程序
------------------------------------------------*/
void SendByte(unsigned char dat)
{
     unsigned char i;

     for(i=0;i&lt;8;i++)
     {
         SRCLK=0;
         SER=dat&amp;0x80;
         dat&lt;&lt;=1;
         SRCLK=1;
    }
}
/*------------------------------------------------
                发送双字节程序
     595级联，n个595，就需要发送n字节后锁存
------------------------------------------------*/
void Send2Byte(unsigned char dat1,unsigned char dat2)
{
    SendByte(dat1);
    SendByte(dat2);
}
/*------------------------------------------------
                   595锁存程序
		  595级联发送数据后，锁存有效
------------------------------------------------*/
void Out595(void)
{
    LATCH=0;
    _nop_();
    LATCH=1;
}
/*------------------------------------------------
                发送位码字节程序
               使用另外一片单独595
------------------------------------------------*/
void SendSeg(unsigned char dat)
{
    unsigned char i;

    for(i=0;i&lt;8;i++)  //发送字节
    {
        SRCLK_B=0;
        SER_B=dat&amp;0x80;
        dat&lt;&lt;=1;
        SRCLK_B=1;
    }
    LATCH_B=0;    //锁存
    _nop_();
    LATCH_B=1;
}
/*------------------------------------------------
                   主程序
------------------------------------------------*/
void main()
{
    unsigned char i;
    while(1)
    {
        for(i=0;i&lt;8;i++) //8列显示
        {
            SendSeg(segout[i]);
            Send2Byte(~tab[i],0xff);
            Out595();
            DelayMs(1);

            Send2Byte(0xff,0xff);//delay(10); //防止重影
            Out595();
        }
    }
}
[/c]