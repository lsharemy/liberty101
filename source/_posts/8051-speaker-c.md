title: 8051 喇叭程序 c
tags:
  - '8051'
id: 731
categories:
  - wordpress
  - index.php
  - csit
date: 2011-12-17 21:46:04
---

通过不同频率的方波，驱动喇叭，得到不同频率的声音。你会发现原来<span style="color: #ff0000;">警车、救护车、消防车</span>的声音是如此简单。

发声原理（其中延时函数与[上篇文章](http://lsharemy.com/wordpress/index.php/csit/8051-key2-c/)相同）：<!--more-->

[c]
main()
{
    while(1)
    {
        //发出大约500Hz的方波 频率越大声音越尖
        DelayMs(1); //延时函数
        SPK=!SPK;   //sbit SPK=P1^2;
    }
}
[/c]

下面就是<span style="color: #ff0000;">警车</span>了，嘿嘿（其实就是频率从一个初值开始递增，增加到一定值后，又从初始频率开始的增，如此反复）：

[c]
/*------------------------------------------------
                    定时器初始化子程序
------------------------------------------------*/
void Init_Timer0(void)
{
    TMOD |= 0x01;    //使用模式1，16位定时器
    EA=1;            //总中断打开
    ET0=1;           //定时器中断打开
    TR0=1;           //定时器开关打开
}
/*------------------------------------------------
                    主函数
------------------------------------------------*/
main()
{
    Init_Timer0();  //初始化定时器
    while(1)
    {
        DelayMs(1); //延时1ms，累加频率值
        frq++;
    }
}
/*------------------------------------------------
                 定时器中断子程序
------------------------------------------------*/
void Timer0_isr(void) interrupt 1
{
    TH0=0xfe;	     //重新赋值
    TL0=frq;         //低8位值在主程序中不断累加
    SPK=!SPK;        //端口电平取反
}
[/c]

下面是<span style="color: #ff0000;">救护车</span>（原理更简单，两个频率切换而已，只贴出主函数）：

[c]
main()
{
    unsigned char i;
    Init_Timer0();       //初始化定时器
    while(1)
    {
        frq=0;
        for(i=0;i&lt;60;i++)//播放1s左右一种频率
        {
            DelayMs(10);
        }
        frq=100;
        for(i=0;i&lt;60;i++)//播放1s左右另外一种频率
        {
            DelayMs(10);
        }
    }
}
[/c]

该<span style="color: #ff0000;">消防车</span>出场了（原理和警车类似，只是在增加到一定频率后，不是回到初试频率，而是从最高频率递减，直到初试频率，然后再递增，如此反复）：

[c]
main()
{
    unsigned char i;
    Init_Timer0();       //初始化定时器
    while(1)
    {
        for(i=0;i&lt;200;i++)
        {
            DelayMs(10); //延时10ms，累加频率值
            frq=i;
        }
        for(i=200;i&gt;0;i--)
        {
            DelayMs(10); //延时10ms，累减频率值
            frq=i;
        }
	}
}
[/c]

当然，喇叭还可以用来演奏音乐，因为每个音符都有固定的频率，只要把这些音符串起来就成了音乐啦。